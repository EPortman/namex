---
kind: "Template"
apiVersion: "v1"
metadata:
  name: "clean-name-datafix"
  annotations:
    description: "Job to update clean_name for all approved names"
    tags: "job"
objects:
- kind: "Job"
  apiVersion: "batch/v1beta1"
  metadata:
    name: "clean-name-datafix"
  spec:
    template:
      spec:
        containers:
        - name: "clean-name-datafix"
        image: "docker-registry.default.svc:5000/servicebc-ne-tools/clean-name-datafix:${ENV_TAG}"
        imagePullPolicy: Always
        args:
        - /bin/sh
        - -c
        - cd /opt/app-root/src; ./run.sh
        env:
          - name: DATABASE_USERNAME
            valueFrom:
              secretKeyRef:
                 key: database-user
                 name: postgresql-${ENV_TAG}
          - name: DATABASE_PASSWORD
            valueFrom:
              secretKeyRef:
                key: database-password
                name: postgresql
                  - name: DATABASE_NAME
                    valueFrom:
                      secretKeyRef:
                        key: database-name
                        name: postgresql-${ENV_TAG}
            - name: DATABASE_HOST
              value: 'postgresql'-${ENV_TAG}
            - name: DATABASE_PORT
              value: '5432'
        restartPolicy: "Never"
        concurrencyPolicy: "Forbid"
parameters: [
        {
          "name": "ENV_TAG",
          "displayName": "ENV_TAG",
          "description": "the tag for the environment that the job image runs from.",
          "required": true,
          "value": "dev"
        },
]